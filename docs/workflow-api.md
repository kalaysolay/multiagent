# Workflow API — контракт ввода

Единый контракт ввода для workflow: run, resume и декомпозиция Use Case.

## Run (запуск workflow)

**Endpoint:** `POST /workflow/run`

**Тело запроса:** только цель пользователя (и опционально идентификатор сессии).

```json
{
  "requestId": "опционально — если не указан, генерируется на бэкенде",
  "goal": "Опиши систему заказов"
}
```

- **Ввод пользователя** — исключительно поле `goal`. Никаких полей `task`, `narrative` или `domainModel` в run не передаётся.

---

## Resume (возобновление после паузы на ревью)

**Endpoint:** `POST /workflow/resume`

**Тело запроса:** идентификатор сессии и отредактированные артефакты.

```json
{
  "requestId": "обязательно",
  "narrative": "отредактированный нарратив (опционально)",
  "domainModel": "отредактированная доменная модель PlantUML (опционально)"
}
```

Используется после паузы на пользовательском ревью. В теле передаются только `requestId` и при необходимости отредактированные `narrative` и/или `domainModel`. Остальные данные (план, состояние шагов) берутся из сессии по `requestId`.

---

## Декомпозиция Use Case

**Endpoint:** `POST /api/usecase/decomposition`

**Тело запроса:** идентификатор сессии и список Use Case для декомпозиции.

```json
{
  "requestId": "обязательно",
  "useCases": [
    { "alias": "reviewGiftByOfficer", "name": "Проверить подарок офицером" }
  ]
}
```

Все входные данные для генерации (нарратив, доменная модель, Use Case модель и т.д.) берутся из сессии по `requestId`. В теле запроса передаётся только идентификатор сессии и список Use Case для декомпозиции (`alias`, `name`).

---

## Историческое примечание: поле `task`

Поле `task` ранее использовалось в запросах и в таблице сессий. Оно выведено из использования; колонка удалена из БД миграцией V14. Контракт основан на `goal` (run) и `narrative`/`domainModel` (resume).
