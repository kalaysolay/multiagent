<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICONIX Workflow Agent - Детали</title>
    <link rel="stylesheet" href="/css/portal.css">
    <link rel="stylesheet" href="/css/workflow.css">
    <link rel="stylesheet" href="/css/diagram-modal.css">
    <script src="/js/auth.js"></script>
    <script src="/js/sidebar.js"></script>
    <style>
        /* Переопределяем стили модального окна для полноэкранного режима */
        #diagramModal .modal-content {
            width: 100% !important;
            height: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            border-radius: 0 !important;
        }
        
        #diagramModal .modal-body {
            height: calc(100% - 120px);
            min-height: calc(100vh - 120px);
        }
        
        #diagramModal #diagramContainer {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Боковое меню (генерируется динамически через sidebar.js) -->
        <div id="sidebar-container"></div>

        <!-- Основной контент -->
        <main class="main-content workflow-detail">
            <div class="content-header">
                <h1>ICONIX Workflow Agent</h1>
                <a href="/iconix-agent-list.html" class="back-link">← Вернуться к списку</a>
            </div>

            <div class="workflow-container">
                <!-- Левая панель: Ввод запроса -->
                <div class="input-panel">
                    <div class="input-section">
                        <label for="narrativeInput">Нарратив / Запрос:</label>
                        <textarea 
                            id="narrativeInput" 
                            placeholder="Введите описание задачи или нарратив..."
                            rows="8"
                        ></textarea>
                    </div>

                    <div class="button-group">
                        <button id="sendButton" class="btn btn-primary">
                            <span class="btn-text">Отправить запрос</span>
                            <span class="btn-loader" style="display: none;">
                                <span class="spinner"></span>
                                Обработка...
                            </span>
                        </button>
                        <button id="resumeButton" class="btn btn-secondary" style="display: none;">
                            <span class="btn-text">Отправить обновления</span>
                            <span class="btn-loader" style="display: none;">
                                <span class="spinner"></span>
                                Отправка...
                            </span>
                        </button>
                    </div>

                    <div id="sessionInfo" class="session-info" style="display: none;">
                        <strong>Сессия:</strong> <span id="sessionId"></span>
                    </div>
                </div>

                <!-- Правая панель: Результаты -->
                <div class="results-panel">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="narrative">Нарратив</button>
                        <button class="tab-btn" data-tab="domain">Доменная модель</button>
                        <button class="tab-btn" data-tab="usecase">Диаграмма прецедентов</button>
                        <button class="tab-btn" data-tab="mvc">MVC-модель</button>
                        <button class="tab-btn" data-tab="scenario">Сценарии</button>
                    </div>

                    <div class="tab-content">
                        <!-- Нарратив -->
                        <div class="tab-pane active" id="narrative-tab">
                            <div class="field-header">
                                <label>Нарратив</label>
                                <button class="copy-btn" data-copy="narrative">Копировать</button>
                            </div>
                            <textarea 
                                id="narrativeOutput" 
                                class="output-field resizable" 
                                readonly
                                placeholder="Нарратив появится здесь..."
                            ></textarea>
                        </div>

                        <!-- Доменная модель -->
                        <div class="tab-pane" id="domain-tab">
                            <div class="field-header">
                                <label>Доменная модель (PlantUML)</label>
                                <div class="field-header-buttons">
                                    <button class="btn-view-diagram" id="viewDomainDiagram" disabled>
                                        Просмотреть диаграмму
                                    </button>
                                    <button class="copy-btn" data-copy="domain">Копировать</button>
                                </div>
                            </div>
                            <textarea 
                                id="domainOutput" 
                                class="output-field resizable editable" 
                                placeholder="Доменная модель появится здесь..."
                            ></textarea>
                            <div class="field-hint">Вы можете редактировать эту модель перед отправкой обновлений</div>
                        </div>

                        <!-- Диаграмма прецедентов -->
                        <div class="tab-pane" id="usecase-tab">
                            <div class="field-header">
                                <label>Диаграмма прецедентов (PlantUML)</label>
                                <div class="field-header-buttons">
                                    <button class="btn-view-diagram" id="viewUseCaseDiagram" disabled>
                                        Просмотреть диаграмму
                                    </button>
                                    <button class="copy-btn" data-copy="usecase">Копировать</button>
                                </div>
                            </div>
                            <textarea 
                                id="usecaseOutput" 
                                class="output-field resizable" 
                                readonly
                                placeholder="Диаграмма прецедентов появится здесь..."
                            ></textarea>
                        </div>

                        <!-- MVC-модель -->
                        <div class="tab-pane" id="mvc-tab">
                            <div class="field-header">
                                <label>MVC-модель (PlantUML)</label>
                                <div class="field-header-buttons">
                                    <button class="btn-view-diagram" id="viewMvcDiagram" disabled>
                                        Просмотреть диаграмму
                                    </button>
                                    <button class="copy-btn" data-copy="mvc">Копировать</button>
                                </div>
                            </div>
                            <textarea 
                                id="mvcOutput" 
                                class="output-field resizable" 
                                readonly
                                placeholder="MVC-модель появится здесь..."
                            ></textarea>
                        </div>

                        <!-- Сценарии -->
                        <div class="tab-pane" id="scenario-tab">
                            <div class="field-header">
                                <label>Сценарии Use Case (AsciiDoc)</label>
                                <button class="copy-btn" data-copy="scenario">Копировать</button>
                            </div>
                            <textarea 
                                id="scenarioOutput" 
                                class="output-field resizable" 
                                readonly
                                placeholder="Сценарии появятся здесь..."
                            ></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Секция декомпозиции Use Case -->
            <div class="usecase-decomposition-section" id="usecaseDecompositionSection" style="display: none;">
                <div class="decomposition-container">
                    <!-- Левый контейнер: Use Case -->
                    <div class="decomposition-left">
                        <div class="decomposition-card">
                            <h3>Декомпозиция Use Case</h3>
                            <div class="decomposition-content">
                                <div class="usecase-list-container">
                                    <label>Выберите Use Case для декомпозиции:</label>
                                    <div id="usecaseList" class="usecase-list">
                                        <!-- Список Use Case будет добавлен динамически -->
                                    </div>
                                </div>
                                <div class="decomposition-actions">
                                    <button id="decomposeButton" class="btn btn-primary" disabled>
                                        <span class="btn-text">Декомпозировать</span>
                                        <span class="btn-loader" style="display: none;">
                                            <span class="spinner"></span>
                                            Декомпозиция...
                                        </span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Правый контейнер: Декомпозированные сценарии -->
                    <div class="decomposition-right">
                        <div class="decomposition-card">
                            <h3>Декомпозированные сценарии</h3>
                            <div id="scenariosContainer" class="scenarios-container">
                                <div class="scenarios-empty">
                                    <p>Выберите Use Case и нажмите "Декомпозировать" для генерации сценариев</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="statusMessage" class="status-message"></div>
        </main>
    </div>

    <!-- Модальное окно для отображения диаграммы -->
    <div id="diagramModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Отрендеренная диаграмма</h2>
                <button class="modal-close" id="closeDiagramModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="diagram-controls">
                    <button id="zoomIn" class="control-btn" title="Увеличить">
                        <span>+</span>
                    </button>
                    <button id="zoomOut" class="control-btn" title="Уменьшить">
                        <span>−</span>
                    </button>
                    <button id="resetZoom" class="control-btn" title="Оригинальный размер">
                        <span>⟲</span>
                    </button>
                    <button id="fullscreen" class="control-btn" title="Во весь экран">
                        <span>⛶</span>
                    </button>
                </div>
                <div id="diagramContainer">
                    <!-- Здесь будет отображена диаграмма -->
                </div>
            </div>
            <div class="modal-footer">
                <div class="footer-left">
                    <span id="zoomLevel" class="zoom-indicator">100%</span>
                </div>
                <div class="footer-right">
                    <button id="downloadPng" class="btn btn-primary">Скачать PNG</button>
                    <button id="downloadSvg" class="btn btn-secondary">Скачать SVG</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для отображения AsciiDoc документа -->
    <div id="documentModal" class="modal" style="display: none;">
        <div class="modal-content document-modal-content">
            <div class="modal-header">
                <h2>Документ Use Case</h2>
                <button class="modal-close" id="closeDocumentModal">&times;</button>
            </div>
            <div class="modal-body document-modal-body">
                <div id="documentContainer">
                    <!-- Здесь будет отображен отрендеренный HTML документ -->
                </div>
            </div>
            <div class="modal-footer">
                <div class="footer-right">
                    <button id="downloadDocument" class="btn btn-primary">Скачать HTML</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/workflow.js"></script>
    <script src="/js/diagram-modal.js"></script>
    <script src="/js/document-modal.js"></script>
</body>
</html>

