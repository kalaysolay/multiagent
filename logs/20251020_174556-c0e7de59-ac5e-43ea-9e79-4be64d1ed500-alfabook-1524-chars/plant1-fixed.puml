@startuml domain_model
Title Обратная связь в AlfaBook
skinparam WrapWidth 150

' Шаг 1. Анализ пользовательской истории
' Старт: Страница статьи AlfaBook
' Цель: Вопрос создан и отображается пользователю в "Мои вопросы" и редактору в "Обратная связь" админ-центра
' Последовательность: Открыть статью -> Нажать "Обратная связь" -> Заполнить форму (текст обязателен, файлы по ограничениям) -> Отправить -> Просмотр в ЛК и админке -> Открытие модального просмотра вопроса из ЛК
' Связи: Пользователь использует GUI-экраны; форма создает Вопрос; Вопрос включает до 10 Вложений; ЛК отображает вопросы автора; админцентр отображает все вопросы; модальное окно просмотра показывает Вопрос

' Шаг 2. Аффинизация существительных (кратко)
' Пользователь → Пользователь (class)
' Редактор → Редактор (class, наследует Пользователь)
' Статья/страница статьи → Статья (entity), СтраницаСтатьи (GUI)
' Модальное окно с формой → МодальнаяФормаОбратнойСвязи (GUI)
' Вопрос/вопрос пользователя → Вопрос (entity)
' Файл/вложения → ВложениеФайла (entity)
' Тип файла → ТипФайла (entity-справочник)
' Статус → СтатусВопроса (entity-справочник)
' Личный кабинет/Мои вопросы → ЛичныйКабинет (GUI)
' Модальное окно просмотра → МодальноеОкноПросмотраВопроса (GUI)
' Центр администрирования/Обратная связь → ЦентрАдминистрирования (GUI)

' Шаг 6. Оценка сложности
' N = 12 элементов, C = 2^12 = 4096

class "Пользователь" as user {
  + {{field}} userId: UUID
}

class "Редактор" as editor {
  + {{field}} editorId: UUID
}
editor --|> user

class "СтраницаСтатьи" as articlePage << (U, #d310e4) GUI >> {
  + {{method}} открытьФормуОбратнойСвязи()
}

class "МодальнаяФормаОбратнойСвязи" as feedbackForm << (U, #d310e4) GUI >> {
  + {{field}} текстКомментария: String
  + {{method}} прикрепитьФайл()
  + {{method}} удалитьФайл()
  + {{method}} отправить()
  + {{method}} отменить()
  + {{method}} закрыть()
}

entity "Вопрос" as question {
  + {{field}} id: UUID
  + {{field}} authorId: UUID
  + {{field}} articleId: UUID
  + {{field}} текстHtml: String
  + {{field}} текстПлейн: String
  + {{field}} статус: СтатусВопроса
  + {{field}} датаСоздания: DateTime
  + {{field}} максКоличествоВложений: Int = 10
  + {{method}} добавитьВложение()
  + {{method}} удалитьВложение()
  + {{method}} проверитьОграниченияВложений()
  + {{method}} проверитьОбязательностьТекста()
}

entity "ВложениеФайла" as attachment {
  + {{field}} id: UUID
  + {{field}} имяФайла: String
  + {{field}} тип: ТипФайла
  + {{field}} mimeType: String
  + {{field}} размерБайт: Long
  + {{field}} storageUrl: String
  + {{field}} максРазмерБайт: Long = 10485760
  + {{method}} проверитьДопустимость()
}

class "ЛичныйКабинет" as account << (U, #d310e4) GUI >> {
  + {{method}} открытьМоиВопросы()
  + {{method}} открытьВопрос()
}

class "МодальноеОкноПросмотраВопроса" as questionModal << (U, #d310e4) GUI >> {
  + {{method}} отобразитьВопрос()
}

class "ЦентрАдминистрирования" as adminCenter << (U, #d310e4) GUI >> {
  + {{method}} просмотретьОбратнуюСвязь()
}

entity "Статья" as article {
  + {{field}} id: UUID
  + {{field}} заголовок: String
}

entity "СтатусВопроса" as questionStatus {
  + {{field}} значение: String ' Например: Новый, В обработке, Закрыт
}

entity "ТипФайла" as fileType {
  + {{field}} код: String ' PDF | DOC | DOCX
}

' Отношения использования пользователем GUI
user ..> articlePage : использование
user ..> feedbackForm : использование
user ..> account : использование
user ..> questionModal : использование
editor ..> adminCenter : использование

' Отношения между GUI
articlePage *-- feedbackForm : открывает модалку
account *-- questionModal : открывает модалку

' Доменные связи и ограничения
feedbackForm -- question : создает при отправить()
question "1" *-- "0..10" attachment : вложения
user "1" -- "0..*" question : автор
article "1" -- "0..*" question : по статье
adminCenter -- question : обратная связь
questionModal -- question : отображает
account ..> user : показывает вопросы автора

@enduml