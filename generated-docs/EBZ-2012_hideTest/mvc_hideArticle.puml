**=== Скрыть статью на портале**

**Цель:**  
Обеспечить возможность редактора скрыть (и позже открыть) статью в публичном портале, изменив её флаг видимости и синхронизировав индекс видимости в подсистеме публикаций.

**Краткое описание:**  
Редактор открывает *Админцентр*, переходит к списку статей, выбирает нужную запись, отмечает чек‑бокс «Скрыть на портале» и сохраняет изменения. Система проверяет, что статья имеет статус **«Активна»**, фиксирует значение флага и сохраняет его в базе. Затем backend‑служба обновляет *ИндексВидимости*; статья исключается из рубрикатора и результатов поиска, а при прямом запросе к её URL пользователь получает страницу ошибки «Статья скрыта». При снятии флага статья вновь становится видимой.

**Акторы:**  
*Редактор* (primary actor)

**Триггер:**  
Редактор нажимает кнопку **«Сохранить»** после установки (или снятия) галочки «Скрыть на портале» в карточке статьи.

**Предварительные условия:**  
1. Редактор аутентифицирован и имеет права редактировать статьи.  
2. Выбранная статья существует в базе и имеет статус **«Активна»**.  
3. Админцентр доступен в пользовательском интерфейсе.

**Успешное финальное состояние:**  
* hideFlag у статьи = `true` (или `false` при снятии).  
* Запись в *ИндексВидимости* помечена как `visible = false` (или `true`).  
* Статья исключена (или включена) из рубрикатора и поисковой выдачи портала.  
* В журнале аудита зафиксировано действие «HideArticle» (или «UnhideArticle»).

**Неуспешные состояния:**  
* Ошибка сохранения в БД → флаг не изменён, пользователь получает сообщение об ошибке.  
* Ошибка обновления индекса → статья остаётся в выдаче, в журнале фиксируется ошибка.  
* Статус статьи не «Активна» → действие отклоняется, пользователь информируется.

**Основной сценарий:**  
1. Редактор открывает *Админцентр*.  
2. Система отображает список статей.  
3. Редактор выбирает нужную статью.  
4. Редактор ставит галочку «Скрыть на портале».  
5. Редактор нажимает **«Сохранить»**.  
6. Система проверяет статус статьи («Активна»).  
7. Система сохраняет новое значение `hideFlag` в сущности *Статья*.  
8. Backend‑служба *ArticleVisibilityService* вызывает *VisibilityIndexUpdater*.  
9. *VisibilityIndexUpdater* обновляет запись в *ИндексВидимости* (`visible = false`).  
10. В *ЖурналАудита* записывается событие «HideArticle».  
11. Пользователь получает подтверждение об успешном сохранении.

**Альтернативные сценарии:**  
*1. Снятие флага* – шаг 4 заменяется на снятие галочки, шаг 7 сохраняет `hideFlag = false`, шаг 9 обновляет `visible = true`.  
*2. Статус статьи не «Активна»* – на шаге 6 система отклоняет действие, выводит сообщение «Статья не может быть скрыта, статус не «Активна»».  
*3. Ошибка сохранения* – на шаге 7 происходит исключение, пользователь получает сообщение «Не удалось сохранить изменения», процесс прекращается.  
*4. Ошибка обновления индекса* – на шаге 9 происходит сбой, система откатывает изменение `hideFlag`, информирует редактора о проблеме с индексацией.

---

```plantuml
@startuml mvc_hideArticle
title Скрыть статью на портале
skinparam WrapWidth 200
left to right direction
skinparam actor {
    BackgroundColor<<user>> #F0F8FF
    BorderColor<<user>> #0000FF
    FontColor<<user>> #000000
    FontStyle bold
    StereotypeFontSize 12
    StereotypeFontColor #0000FF
}
' Actors
actor "Редактор" as editor <<user>>

' Boundary (GUI)
boundary "Админцентр" as adminCenter << (U,#ADD8E6) GUI >>

' Controls
control "UIController" as uiCtrl << Frontend >>
control "ArticleVisibilityService" as svc << Backend >>
control "VisibilityIndexUpdater" as updater << Backend >>
control "AuditLogger" as logger << Backend >>

' Entities
entity "Статья" as Article
entity "ИндексВидимости" as VisibilityIndex
entity "ЖурналАудита" as AuditLog

' Connections
editor --> adminCenter
adminCenter --> uiCtrl
uiCtrl --> svc
svc --> Article
svc --> VisibilityIndex
svc --> updater
svc --> logger
updater --> VisibilityIndex
logger --> AuditLog

@enduml
```

---

## Предложение по группировке прецедентов

| Группа | Описание | Основные базовые прецеденты | Кому удобно работать |
|--------|----------|-----------------------------|----------------------|
| **Управление видимостью контента** | Операции, влияющие на отображение статей в публичном портале (скрытие/открытие, индексация). | *Скрыть статью на портале* (HideArticle), *Показать статью на портале* (UnhideArticle – потенциальный базовый прецедент). | **Frontend** – UI‑контроллеры, формы в *Админцентре*; **Backend** – сервисы `ArticleVisibilityService`, `VisibilityIndexUpdater`, `AuditLogger`. |
| **Работа с каталогом статей** | Создание, редактирование, согласование и публикация статей разных типов. | (в текущем наборе нет базовых, но в дальнейшем – *Создать статью*, *Редактировать статью*, *Опубликовать статью*). | **Frontend** – формы ввода, редакторы; **Backend** – бизнес‑логика статей, workflow‑модуль. |
| **Поиск и навигация пользователя** | Поиск статей, просмотр рубрикатора, обработка запросов к скрытым статьям. | *Поиск статьи*, *Просмотр рубрикатора*, *Открыть статью* (не базовые, но вспомогательные). | **Frontend** – UI‑компоненты поиска; **Backend** – поисковый сервис, проверка `hideFlag`. |

**Рекомендация:**  
Сформировать два репозитория (или два подпакета в монорепозитории):

1. `frontend/article-visibility` – UI‑слой (boundary, frontend‑controls, представления).  
2. `backend/article-visibility` – бизнес‑логика (backend‑controls, сервисы, сущности, аудит).

Такой раздел позволит фронтенд‑разработчикам работать только с `adminCenter`, `UIController` и формами, а бэкенд‑разработчикам – с `ArticleVisibilityService`, `VisibilityIndexUpdater`, `AuditLogger` и сущностями `Article`, `VisibilityIndex`. При необходимости обе части могут быть собраны в единую интеграционную сборку для полной проверки сценариев.