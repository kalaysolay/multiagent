```asciidoc
= UC: Отобразить статью на портале

Цель::
Показать пользователю содержимое выбранной статьи, если она доступна для публичного просмотра.

Акторы::
- **Пользователь** (главный актор)  
- **Сервер Портала** (внешняя система)  
- **Подсистема Публикаций** (внешняя система)  
- **Кеш‑менеджер** (внешняя система)  
- **Журнал Аудита** (внешняя система)  
- **Страница Ошибки** (внешняя система)

Границы системы::
. Основной поток:  
  * Пользователь инициирует запрос к статье.  
  * Фронтенд отправляет запрос к серверу портала.  
  * Сервер проверяет флаг скрытия и статус статьи.  
  * При положительном результате сервер возвращает HTML‑страницу статьи, которая отображается пользователю.  
. Обрабатываемые ошибки:  
  * Статья помечена флагом «Скрыть».  
  * Статус статьи не «Активна» (например, «Архивная», «Удалённая»).  
  * Статья не найдена в базе.

[%%collapsible]
.Диаграмма
====
[plantuml]
@startuml
actor "Пользователь" as User
boundary "Portal UI" as UI
control "PortalServer" as PS
database "ArticleDB" as DB
control "PublicationSubsystem" as Pub
control "CacheManager" as Cache
control "AuditLog" as Audit
entity "ErrorPage" as EP

User -> UI : открыть ссылку на статью
UI -> PS : GET /article/{id}
opt [Р-30.1] проверка кеша
    PS -> Cache : запросить кеш
    alt кеш‑хит
        Cache --> PS : статья из кеша
    else кеш‑мисс
        Cache --> PS : miss
    end
end
PS -> DB : SELECT * FROM Article WHERE id={id}
PS -> Pub : проверить hideFlag и статус
alt статья видима
    PS -> UI : вернуть HTML‑страницу статьи
else статья скрыта
    PS -> EP : вернуть страницу «Статья скрыта»
else статус не активен
    PS -> EP : вернуть страницу «Статья не актуальна»
else статья не найдена
    PS -> EP : вернуть 404‑страницу
end
PS -> Audit : записать действие «viewArticle»
@enduml
====
 

Предусловия::
1. Пользователь имеет доступ к публичному порталу (роль **any**).  
2. Статья с указанным идентификатором существует в системе (может быть скрыта или иметь любой статус).

Успешный результат::
Пользователь видит полностью отрендеренную страницу выбранной статьи.

Возможные ошибки::
* **404 Not Found** – статья не найдена.  
* **403 Forbidden** – статья скрыта флагом «Скрыть».  
* **410 Gone** – статья имеет статус, не допускающий публичного отображения (архив, удалена).

Триггер::
Пользователь кликает по ссылке «Открыть статью» в поисковой выдаче, рубрикаторе или на внешнем ресурсе.

== Основной сценарий
[options="header"]
|=== 
| Шаг | Действие
| ШАГ 10 | Пользователь нажимает ссылку на статью (триггер). 
| ШАГ 20 | UI (boundary) отправляет запрос GET /article/{id} к PortalServer (control). 
| ШАГ 30 | PortalServer запрашивает данные статьи у ArticleDB (database) и проверяет hideFlag и статус через PublicationSubsystem (control). 
| ШАГ 40 | Если hideFlag = **false** и status = **«Активна»**, PortalServer формирует HTML‑страницу статьи и передаёт её UI. 
| ШАГ 50 | UI отображает содержимое статьи пользователю. 
|===

*Успешное финальное состояние* – ШАГ 50, пользователь видит страницу статьи.

== Альтернативы  

=== [ШАГ 30A] Статья скрыта флагом «Скрыть»
|=== 
| Шаг | Действие
| 30A | PortalServer получает запись статьи, обнаруживает hideFlag = **true**. 
| 40A | PortalServer вызывает ErrorPage и формирует сообщение «Статья скрыта». 
| 50A | UI отображает страницу ошибки пользователю. 
|===

*Неуспешное финальное состояние* – ШАГ 50A, пользователь видит сообщение «Статья скрыта».

=== [ШАГ 30Б] Статус статьи не «Активна»
|=== 
| Шаг | Действие
| 30Б | PortalServer получает запись статьи, статус ≠ «Активна». 
| 40Б | PortalServer вызывает ErrorPage с сообщением «Статья не актуальна». 
| 50Б | UI отображает страницу ошибки пользователю. 
|===

*Неуспешное финальное состояние* – ШАГ 50Б, пользователь видит сообщение «Статья не актуальна».

=== [ШАГ 30В] Статья не найдена
|=== 
| Шаг | Действие
| 30В | Запрос к ArticleDB возвращает **null**. 
| 40В | PortalServer формирует 404‑страницу ошибки. 
| 50В | UI отображает 404‑страницу пользователю. 
|===

*Неуспешное финальное состояние* – ШАГ 50В, пользователь видит 404‑страницу.

== Расширения  

* [Р‑30.1] **Проверка кеша** – перед запросом к базе данных PortalServer может обратиться к CacheManager. При кеш‑хите статья берётся из кеша, иначе происходит запрос к базе (см. диаграмму).  
* [Р‑30.2] **Запись в журнал аудита** – после формирования ответа (успешного или ошибочного) PortalServer отправляет событие в AuditLog с деталями действия «viewArticle».  

---  

*Нумерация сообщений последовательности (для справки)*  

- boundary -> control : **[<b>20]** GET /article/{id}  
- control -> database : **[<b>30]** SELECT * FROM Article WHERE id={id}  
- control -> PublicationSubsystem : **[<b>30]** проверить hideFlag и статус  
- control -> ErrorPage (alt) : **[<b>40A]** вернуть страницу «Статья скрыта»  
- control -> ErrorPage (alt) : **[<b>40Б]** вернуть страницу «Статья не актуальна»  
- control -> ErrorPage (alt) : **[<b>40В]** вернуть 404‑страницу  
- control -> UI (return) : **[<b>50]** вернуть HTML‑страницу статьи  
- control -> UI (return) : **[<b>50A]** вернуть страницу ошибки  
- control -> AuditLog : **[<b>R‑30.2]** записать действие  

```