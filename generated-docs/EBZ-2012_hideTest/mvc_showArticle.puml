**=== Отобразить статью на портале**  

Цель: отобразить пользователю Портала ЕБЗ содержимое статьи, учитывая её статус и флаг «Скрыть на портале».  

Краткое описание: Пользователь Портала вводит запрос в поиск / просматривает рубрикатор. При выборе статьи система проверяет её статус и флаг скрытия. Если статья активна и флаг не установлен – пользователь получает обычную страницу статьи. Если флаг установлен – пользователь получает страницу ошибки «Статья скрыта».  

Акторы:  
* **Пользователь Портала** (PortalUser) – основной актор, инициирует запрос к статье.  
* **Редактор** (Editor) – может изменить флаг скрытия, но в данном базовом прецеденте участвует лишь как «внешний» актор (не инициирует сценарий отображения).  

Триггер: запрос пользователя к странице статьи (по URL, из поиска или рубрикатора).  

Предварительные условия:  
1. Статья существует в базе данных.  
2. Статья имеет статус «Активна».  

Успешное финальное состояние: пользователь видит содержимое статьи.  

Неуспешные состояния:  
* Статья скрыта – пользователь видит страницу ошибки «Статья скрыта».  
* Статья не найдена или имеет статус, отличный от «Активна» – пользователь видит страницу ошибки «Статья недоступна».  

**Основной сценарий:**  
1. Пользователь переходит по ссылке на статью.  
2. Front‑end (boundary) передаёт запрос в контроллер `ShowArticleController`.  
3. `ShowArticleController` вызывает `VisibilityCheck` (backend control).  
4. `VisibilityCheck` запрашивает у `ArticleService` данные статьи и её флаг скрытия.  
5. `ArticleService` читает сущность `Article` и, при необходимости, `VisibilityIndex`.  
6. Если флаг скрытия **не** установлен → `ShowArticleController` формирует обычный `ArticlePage` и отдаёт её пользователю.  
7. Сценарий завершается успешно.  

**Альтернативные сценарии:**  
* **A1 – Статья скрыта:**  
  4‑5. `VisibilityCheck` обнаруживает `hideFlag = true`.  
  6. `ShowArticleController` перенаправляет запрос к `ErrorHandler`.  
  7. `ErrorHandler` формирует `ErrorPage` с сообщением «Статья скрыта».  

* **A2 – Статья не активна / не найдена:**  
  4‑5. `ArticleService` возвращает `null` или статус ≠ «Активна».  
  6. `ShowArticleController` передаёт управление `ErrorHandler`.  
  7. `ErrorHandler` формирует `ErrorPage` с сообщением «Статья недоступна».  

```asciidoc
[source,plantuml]
----
@startuml mvc_showArticle
title Отобразить статью на портале
skinparam WrapWidth 200
left to right direction
skinparam actor {
    BackgroundColor<<user>> #F0F8FF
    BorderColor<<user>> #2B7A78
    FontColor<<user>> #2B7A78
    FontStyle bold
}
' Actors
actor "Пользователь Портала" as portalUser <<user>>
actor "Редактор" as editor <<user>>

' Boundary (GUI)
boundary "ArticlePage" as articlePage

' Controls
control "ShowArticleController" as showCtrl <<Frontend>>
control "VisibilityCheck" as visCheck <<Backend>>
control "ErrorHandler" as errHandler <<Backend>>

' Entities
entity "Article" as article {
    + id: UUID
    + title: String
    + status: String
    + hideFlag: Boolean
}
entity "VisibilityIndex" as visIdx {
    + articleId: UUID
    + visible: Boolean
}

' Relationships (allowed only)
portalUser -- articlePage
articlePage -- showCtrl
showCtrl -- visCheck
visCheck -- article
visCheck -- visIdx
showCtrl -- errHandler
errHandler -- articlePage

@enduml
----
```

---

## Предложение по группировке базовых прецедентов

| Группа | Содержит базовые прецеденты | Целевые разработчики | Краткое назначение |
|--------|-----------------------------|----------------------|--------------------|
| **1. Управление видимостью статьи** | *Скрыть/открыть статью* (действия редактора) | Backend‑разработчики (логика изменения флага, обновление индекса) | Позволяет редактору менять `hideFlag` и инициировать пересчёт `VisibilityIndex`. |
| **2. Отображение статьи** | *Отобразить статью на портале* (рассмотренный выше) | Frontend‑разработчики (UI, роутинг) + Backend‑разработчики (проверка видимости, сервис статей) | Обеспечивает корректный вывод статьи пользователю с учётом её статуса и флага скрытия. |
| **3. Поисковый и рубрикаторный доступ** | *Поиск статей*, *Просмотр рубрикатора* (не помечены как base, но логически связаны) | Frontend‑разработчики (компоненты поиска, рубрикатора) + Backend‑разработчики (поисковый сервис, фильтрация по `VisibilityIndex`) | Делает статьи доступными/недоступными в результатах поиска и в рубрикаторе. |

**Рекомендации по работе:**  

* **Frontend‑команда** фокусируется на границах (`ArticlePage`, `SearchWidget`, `RubricatorView`) и контроллерах `<<Frontend>>` (`ShowArticleController`, `SearchController`).  
* **Backend‑команда** реализует бизнес‑логика в контроллерах `<<Backend>>` (`VisibilityCheck`, `ArticleService`, `VisibilityIndexUpdater`) и управляет сущностями `Article`, `VisibilityIndex`.  
* Общие артефакты (DTO, API‑контракты) размещаются в отдельном модуле «shared», что упрощает синхронизацию между командами.  

Такое разделение позволяет каждому стеку работать в своей зоне ответственности, не пересекаясь лишний раз, но при этом сохраняет полную трассируемость сценариев от UI до БД.