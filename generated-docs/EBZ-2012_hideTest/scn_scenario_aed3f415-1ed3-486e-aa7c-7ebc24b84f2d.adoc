= UC: Скрыть статью на портале

Цель::
Обеспечить возможность редактора скрыть опубликованную статью из публичного каталога и поисковой выдачи.

Акторы::
- **Редактор** – пользователь системы, имеющий права доступа к администрированию.

Границы системы::
. **Основной поток:** Открытие админ‑центра → переход к списку статей → выбор статьи → установка флага «Скрыть» → сохранение → проверка статуса и флага → обновление индекса видимости → исключение из рубрикатора → пометка ссылки как недоступной → подтверждение пользователю.  
. **Обрабатываемые ошибки:**  
  * Ошибка статуса статьи (статья не «Активна»).  
  * Ошибка сохранения изменений в БД.  
  * Ошибка обновления индекса видимости.

[%%collapsible]
.Диаграмма
====
[plantuml]
@startuml mvc_hideArticle
title Скрыть статью на портале
skinparam WrapWidth 200
left to right direction

actor "Редактор" as editor << user >>

boundary "AdminCenter" as adminCenter << (U,#FFAAAA) GUI >>

control "Открыть центр администрирования" as openAdmin << Frontend >>
control "Перейти к списку статей" as goToList << Frontend >>
control "Выбрать статью" as selectArticle << Frontend >>
control "Отметить флаг скрытия" as markHide << Frontend >>
control "Сохранить изменения" as saveChanges << Frontend >>
control "Проверить флаг скрытия и статус" as checkHide << Backend >>
control "Обновить индекс видимости" as updateIndex << Backend >>
control "Исключить статью из рубрикатора" as excludeCatalog << Backend >>
control "Пометить ссылку как недоступную" as markLink << Backend >>
control "Инвалидация кэша публикаций" as invalidateCache << Backend >>

entity "Статья" as Article {
    hideFlag : Boolean
    status   : String
}
entity "ИндексВидимости" as VisibilityIndex {
    visible : Boolean
}

editor --> adminCenter
adminCenter --> openAdmin
openAdmin --> goToList
goToList --> selectArticle
selectArticle --> markHide
markHide --> saveChanges
saveChanges --> checkHide
checkHide --> updateIndex
updateIndex --> excludeCatalog
excludeCatalog --> markLink
updateIndex --> invalidateCache

checkHide --> Article
updateIndex --> VisibilityIndex
excludeCatalog --> Article
markLink --> Article
@enduml
====
[%%]

Предусловия::
1. Редактор аутентифицирован и имеет роль **Редактор** (доступ к администрированию).  
2. Выбранная статья находится в статусе **«Активна»**.

Успешный результат::
Статья сохраняет `hideFlag = true`, индекс видимости обновлён (`visible = false`), статья исключена из рубрикатора и её прямая ссылка возвращает страницу ошибки «Статья скрыта». Пользователь видит подтверждающее сообщение «Статья успешно скрыта».

Возможные ошибки::
* **ERR‑STATUS** – «Статус статьи не позволяет скрыть».  
* **ERR‑SAVE** – «Не удалось сохранить изменения».  
* **ERR‑INDEX** – «Не удалось обновить индекс видимости».  

Триггер::
Редактор нажимает кнопку **«Сохранить»** в карточке статьи после установки флажка «Скрыть на портале».

== Основной сценарий  

* **ШАГ 10** – Открыть центр администрирования (boundary).  
* **ШАГ 20** – Перейти к списку статей (control).  
* **ШАГ 30** – Выбрать нужную статью (control).  
* **ШАГ 40** – Отметить флаг «Скрыть на портале» (control).  
* **ШАГ 50** – Сохранить изменения (control).  
* **ШАГ 60** – Система проверяет флаг скрытия и статус статьи (control).  
* **ШАГ 70** – Система обновляет индекс видимости (control) **[Р‑70.1]**.  
* **ШАГ 80** – Система исключает статью из рубрикатора (control).  
* **ШАГ 90** – Система помечает ссылку как недоступную (control).  
* **ШАГ 100** – Отображается подтверждение «Статья успешно скрыта» (boundary).  

Успешное финальное состояние – **ШАГ 100**.

== Альтернативы  

* **[ШАГ 50 A]** – После попытки сохранения система обнаруживает, что статья имеет статус, отличный от «Активна».  
  * Вывод сообщения **ERR‑STATUS**.  
  * Процесс завершается без изменения флага.  

* **[ШАГ 50 B]** – При сохранении в базе данных происходит конфликт версии или другая ошибка.  
  * Вывод сообщения **ERR‑SAVE**.  
  * Процесс завершается, статья остаётся видимой.  

* **[ШАГ 70 A]** – Обновление индекса видимости завершается с ошибкой (например, недоступность подсистемы публикаций).  
  * Вывод сообщения **ERR‑INDEX**.  
  * Процесс завершается, изменения флага сохраняются, но статья остаётся в каталоге до исправления ошибки.  

Каждая альтернативная ветка заканчивается соответствующим неуспешным финальным состоянием, перечисленным в разделе *Возможные ошибки*.

== Расширения  

* **[Р‑70.1]** – После успешного обновления индекса система выполняет инвалидацию кэша публикаций (контроллер `invalidateCache`). Данный шаг является необязательным и выполняется только при наличии включённого кэш‑механизма.  

* Специальные требования к вариативности не предъявляются (других `opt`‑блоков на диаграмме нет).  